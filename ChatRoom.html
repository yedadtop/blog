<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<title>ç¾¤èŠ</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;}
body{display:flex;flex-direction:column;height:100vh;background:#f5f5f5;}
#header{height:48px;background:#07c160;color:#fff;display:flex;align-items:center;justify-content:flex-end;padding:0 15px;font-size:16px;box-shadow:0 2px 4px rgba(0,0,0,.1);}
#header span{margin-left:10px;}
#renamePop{position:absolute;top:52px;right:12px;background:#fff;border:1px solid #ddd;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.15);padding:10px;display:none;z-index:999;}
#renamePop input{width:140px;padding:6px 8px;font-size:14px;border:1px solid #ccc;border-radius:4px;}
#renamePop button{margin-left:6px;padding:6px 10px;font-size:14px;border:none;border-radius:4px;background:#07c160;color:#fff;cursor:pointer;}
#renamePop button.cancel{background:#999;margin-left:4px;}
#box{flex:1;overflow-y:auto;padding:10px;}
.msg{margin:8px 0;display:flex;}
.msg.me{justify-content:flex-end;}

/* é»˜è®¤æ ·å¼ - æ¶ˆæ¯æ¡†å®½åº¦è‡ªé€‚åº” */
.msg .content{
  display:inline-block;
  max-width:90%;
  text-align:left;
}

.msg.me .content{
  text-align:right;
}

.msg .name{
  font-size:12px;
  color:#666;
  margin:0 10px 4px;
}

.msg.me .name{
  text-align:right;
  color:#888;
}

.msg .bubble{
  display:inline-block;
  padding:9px 12px;
  border-radius:10px;
  font-size:15px;
  line-height:1.45;
  word-break:break-word;
  white-space:pre-wrap;
  text-align:justify;          /* ä¸¤ç«¯å¯¹é½ */
  text-align-last:left;        /* æœ€åä¸€è¡Œå·¦å¯¹é½ */
  width:auto;                  /* å®½åº¦è‡ªé€‚åº”å†…å®¹ */
  max-width:100%;              /* æœ€å¤§å®½åº¦ä¸è¶…è¿‡å®¹å™¨ */
  min-width: min-content;      /* æœ€å°å®½åº¦æ ¹æ®å†…å®¹è°ƒæ•´ */
}

/* ä¸åŒå±å¹•å°ºå¯¸çš„æ¶ˆæ¯æ¡†é€‚é… */
@media screen and (min-width: 1200px) {
  /* å¤§å±å¹• (>=1200px) */
  .msg .content {
    max-width: 40%;
  }
}

@media screen and (min-width: 768px) and (max-width: 1199px) {
  /* ä¸­ç­‰å±å¹• (768px-1199px) */
  .msg .content {
    max-width: 50%;
  }
}

@media screen and (max-width: 767px) {
  /* å°å±å¹• (<768px) */
  .msg .content {
    max-width: 80%;
  }
}

.msg.others .bubble{
  background:#fff;
}

.msg.me   .bubble{
  background:#95ec69;
  color:#000;
}
#footer{height:56px;border-top:1px solid #e5e5e5;display:flex;background:#fff;align-items:center;padding:0 10px;}
#footer textarea{flex:1;border:none;padding:10px 15px;font-size:16px;outline:none;resize:none;line-height:1.4;background:#f8f8f8;border-radius:20px;margin:0 10px;}
#footer button{height:40px;border:none;background:#07c160;color:#fff;font-size:16px;cursor:pointer;border-radius:20px;transition:all 0.2s ease;display:flex;align-items:center;justify-content:center;}

/* å‘é€æŒ‰é’®æ ·å¼ */
#sendBtn{
  width:60px;
  font-weight:500;
  background:#07c160;
}

#sendBtn:hover{
  background:#06ae56;
  transform:scale(1.02);
}

#sendBtn:active{
  transform:scale(0.98);
}

#sendBtn:disabled{
  background:#ccc;
  cursor:not-allowed;
  transform:none;
}

/* åŠ å·æŒ‰é’®æ ·å¼ */
#plusBtn {
  width:40px;
  height:40px;
  border:none;
  background:#f0f0f0;
  font-size:20px;
  color:#666;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  transition:all 0.2s ease;
  margin:0 5px;
}

#plusBtn:hover {
  background:#e0e0e0;
  color:#07c160;
  transform:scale(1.1);
}

#plusBtn:active {
  transform:scale(0.95);
}

/* åŠŸèƒ½æŒ‰é’®åŒºåŸŸæ ·å¼ */
#functionPanel {
  position:fixed;
  bottom:56px;
  left:0;
  right:0;
  background:#f9f9f9;
  border-top:1px solid #e5e5e5;
  padding:15px;
  display:none;
  flex-wrap:wrap;
  gap:15px;
  box-shadow:0 -2px 10px rgba(0,0,0,0.1);
  z-index:100;
}

.functionBtn {
  width:60px;
  height:60px;
  border:none;
  background:#fff;
  border-radius:12px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  font-size:12px;
  color:#333;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  transition:all 0.2s ease;
}

.functionBtn:hover {
  background:#07c160;
  color:#fff;
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
}

.functionBtn .icon {
  font-size:20px;
  margin-bottom:5px;
}

#imageInput {
  display:none;
}

/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width:400px){
  #header,#footer{height:50px;}
  #footer{padding:0 8px;}
  #footer textarea{margin:0 5px;padding:8px 12px;}
  #plusBtn,#sendBtn{width:36px;height:36px;font-size:14px;}
  #plusBtn{margin:0 3px;}
}

/* å›¾ç‰‡æ¶ˆæ¯æ ·å¼ */
.msg .image-bubble {
  max-width: 200px;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.msg .image-bubble img {
  width: 100%;
  height: auto;
  display: block;
}

@media (max-width:400px){#header,#footer{height:50px;}}
</style>
</head>
<body>
<div id="header">
  <span id="myName">User85e3</span>
  <span id="userIcon">ğŸ‘¤</span>
</div>

<div id="renamePop">
  <input id="newName" maxlength="12" placeholder="æ–°æ˜µç§°">
  <button id="saveName">ä¿å­˜</button>
  <button class="cancel" id="cancelName">å–æ¶ˆ</button>
</div>

<div id="box"></div>

<!-- åŠŸèƒ½æŒ‰é’®åŒºåŸŸ -->
<div id="functionPanel">
  <button class="functionBtn" id="imageBtn">
    <span class="icon">ğŸ–¼ï¸</span>
    <span>å›¾ç‰‡</span>
  </button>
  <!-- å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šåŠŸèƒ½æŒ‰é’® -->
</div>

<div id="footer">
  <textarea id="txt" rows="1" placeholder="è¯´ç‚¹ä»€ä¹ˆâ€¦"></textarea>
  <button id="plusBtn">â•</button>
  <button id="sendBtn">å‘é€</button>
</div>

<!-- éšè—çš„æ–‡ä»¶è¾“å…¥æ¡† -->
<input type="file" id="imageInput" accept="image/*">

<script>
const uid = 'u6919b581685e3';
const color = '#EC4F66';
let last = 0;
const renderedIds = new Set();
const pendingSet = new Set();

const box = document.getElementById('box');
const txt = document.getElementById('txt');
const sendBtn = document.getElementById('sendBtn');
const myNameSpan = document.getElementById('myName');
const userIcon = document.getElementById('userIcon');
const renamePop = document.getElementById('renamePop');
const newNameInput = document.getElementById('newName');
const saveNameBtn = document.getElementById('saveName');
const cancelNameBtn = document.getElementById('cancelName');

// æ–°å¢å…ƒç´ 
const plusBtn = document.getElementById('plusBtn');
const functionPanel = document.getElementById('functionPanel');
const imageBtn = document.getElementById('imageBtn');
const imageInput = document.getElementById('imageInput');

userIcon.onclick = () => {
  renamePop.style.display = renamePop.style.display === 'block' ? 'none' : 'block';
  newNameInput.value = myNameSpan.textContent;
  newNameInput.focus();
};
cancelNameBtn.onclick = () => renamePop.style.display = 'none';

saveNameBtn.onclick = () => {
  const nn = newNameInput.value.trim();
  if (!nn) return alert('æ˜µç§°ä¸èƒ½ä¸ºç©º');
  fetch('api.php', {
    method: 'POST',
    headers: {'Content-Type':'application/x-www-form-urlencoded'},
    body: 'act=rename&uid=' + uid + '&name=' + encodeURIComponent(nn)
  }).then(r => r.json())
    .then(res => {
      if (res.ok) {
        myNameSpan.textContent = nn;
        renamePop.style.display = 'none';
      } else {
        alert(res.err || 'ä¿®æ”¹å¤±è´¥');
      }
  });
};

// åŠŸèƒ½æŒ‰é’®äº¤äº’é€»è¾‘
plusBtn.onclick = () => {
  const isVisible = functionPanel.style.display === 'flex';
  if (!isVisible) {
    functionPanel.style.display = 'flex';
    // æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨ä»¥æ˜¾ç¤ºåŠŸèƒ½é¢æ¿
    window.scrollTo(0, document.body.scrollHeight);
  } else {
    functionPanel.style.display = 'none';
  }
};

// å›¾ç‰‡æŒ‰é’®ç‚¹å‡»äº‹ä»¶
imageBtn.onclick = () => {
  imageInput.click();
};

// å›¾ç‰‡é€‰æ‹©äº‹ä»¶
imageInput.onchange = (e) => {
  const file = e.target.files[0];
  if (!file) return;
  
  if (!file.type.startsWith('image/')) {
    alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
    return;
  }
  
  // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ä¸º5MBï¼‰
  if (file.size > 5 * 1024 * 1024) {
    alert('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB');
    return;
  }
  
  // ä¸Šä¼ å›¾ç‰‡
  uploadImage(file);
};

// ä¸Šä¼ å›¾ç‰‡å‡½æ•°
function uploadImage(file) {
  const formData = new FormData();
  formData.append('act', 'uploadImage');
  formData.append('uid', uid);
  formData.append('name', myNameSpan.textContent);
  formData.append('color', color);
  formData.append('image', file);
  
  // ç”Ÿæˆä¸´æ—¶çš„å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºpendingSetæ£€æµ‹
  const tempId = 'img_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
  const sig = uid + '|' + tempId;
  pendingSet.add(sig);
  
  fetch('api.php', {
    method: 'POST',
    body: formData
  })
  .then(r => r.json())
  .then(data => {
    if (data.ok) {
      // ç§»é™¤pendingæ ‡è¯†
      pendingSet.delete(sig);
      
      // æ˜¾ç¤ºå›¾ç‰‡æ¶ˆæ¯ï¼ˆåŒ…å«æ¶ˆæ¯IDï¼‰
      appendImageMessage(data.imageUrl, data.imageName, data.msgId);
      // éšè—åŠŸèƒ½é¢æ¿
      functionPanel.style.display = 'none';
      // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
      imageInput.value = '';
      // ç«‹å³æ›´æ–°last IDï¼Œé¿å…è½®è¯¢é‡å¤æ‹‰å–
      if (data.msgId) {
        last = Math.max(last, data.msgId);
        renderedIds.add(data.msgId);
      }
    } else {
      // ä¸Šä¼ å¤±è´¥æ—¶ä¹Ÿè¦ç§»é™¤pendingæ ‡è¯†
      pendingSet.delete(sig);
      alert(data.err || 'å›¾ç‰‡ä¸Šä¼ å¤±è´¥');
    }
  })
  .catch(err => {
    // ç½‘ç»œé”™è¯¯æ—¶ä¹Ÿè¦ç§»é™¤pendingæ ‡è¯†
    pendingSet.delete(sig);
    console.error('ä¸Šä¼ é”™è¯¯:', err);
    alert('ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•');
  });
}

// æ·»åŠ å›¾ç‰‡æ¶ˆæ¯åˆ°èŠå¤©æ¡†ï¼ˆåŒ…å«æ¶ˆæ¯IDï¼‰
function appendImageMessage(imageUrl, imageName, msgId) {
  // æ£€æŸ¥æ˜¯å¦å·²ç»æ¸²æŸ“è¿‡
  if (msgId && renderedIds.has(msgId)) {
    console.log('å›¾ç‰‡æ¶ˆæ¯å·²å­˜åœ¨ï¼Œè·³è¿‡æ¸²æŸ“:', msgId);
    return;
  }
  
  const div = document.createElement('div');
  div.className = 'msg me';
  
  // å¦‚æœæœ‰æ¶ˆæ¯IDï¼Œæ·»åŠ åˆ°å·²æ¸²æŸ“é›†åˆ
  if (msgId) {
    renderedIds.add(msgId);
  }
  
  div.innerHTML = `
    <div class="content">
      <div class="name">${myNameSpan.textContent}</div>
      <div class="image-bubble">
        <img src="http://10.0.0.1:8080/ChatRoom/${imageUrl}" alt="${imageName}" onerror="this.style.display='none';this.parentElement.innerHTML='å›¾ç‰‡åŠ è½½å¤±è´¥'">
      </div>
    </div>`;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}

// ä¿®æ”¹appendMessageå‡½æ•°ä»¥æ”¯æŒå›¾ç‰‡æ¶ˆæ¯
function appendMessage(m) {
  // é¦–å…ˆæ£€æŸ¥æ¶ˆæ¯IDæ˜¯å¦å·²å­˜åœ¨
  if (m.id && renderedIds.has(m.id)) {
    console.log('æ¶ˆæ¯å·²å­˜åœ¨ï¼Œè·³è¿‡æ¸²æŸ“:', m.id);
    return;
  }
  
  // å¦‚æœæ˜¯å›¾ç‰‡æ¶ˆæ¯ï¼Œæ£€æŸ¥pendingçŠ¶æ€
  if (m.txt && m.txt.includes('image:')) {
    // ä¸ºå›¾ç‰‡æ¶ˆæ¯ç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„pendingæ ‡è¯†
    const imgSig = m.uid + '|img_' + m.id;
    if (pendingSet.has(imgSig)) {
      console.log('å›¾ç‰‡æ¶ˆæ¯æ­£åœ¨å¤„ç†ä¸­ï¼Œè·³è¿‡æ¸²æŸ“:', m.id);
      return;
    }
  }
  
  // æ£€æŸ¥æ–‡æœ¬æ¶ˆæ¯çš„pendingçŠ¶æ€
  const sig = m.uid + '|' + m.txt;
  if (pendingSet.has(sig)) {
    pendingSet.delete(sig);
    return;
  }

  // æ·»åŠ åˆ°å·²æ¸²æŸ“é›†åˆ
  if (m.id) {
    renderedIds.add(m.id);
  }

  const div = document.createElement('div');
  div.className = m.uid === uid ? 'msg me' : 'msg others';
  
  // åˆ¤æ–­æ˜¯å¦ä¸ºå›¾ç‰‡æ¶ˆæ¯
  if (m.txt && m.txt.includes('image:')) {
    const imageUrl = m.txt.replace('image:', '');
    div.innerHTML = `
      <div class="content">
        <div class="name">${m.name}</div>
        <div class="image-bubble">
          <img src="http://10.0.0.1:8080/ChatRoom/${imageUrl}" alt="å›¾ç‰‡" onerror="this.style.display='none';this.parentElement.innerHTML='å›¾ç‰‡åŠ è½½å¤±è´¥'">
        </div>
      </div>`;
  } else {
    div.innerHTML = `
      <div class="content">
        <div class="name">${m.name}</div>
        <div class="bubble">${m.txt.replace(/<br>/g,'<br style="display:block;text-align:left">')}</div>
      </div>`;
  }
  
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
  
  // æ›´æ–°last ID
  if (m.id) {
    last = Math.max(last, m.id);
  }
}

// æ–‡æœ¬æ¶ˆæ¯å‘é€å‡½æ•°
sendBtn.onclick = () => {
  const v = txt.value.trim();
  if (!v) return;
  const msg = v.replace(/\r?\n/g, '<br>');
  txt.value = '';

  // æ£€æŸ¥æ˜¯å¦ä¸ºclearå‘½ä»¤
  if (v.toLowerCase() === 'clear') {
    // æ¸…ç©ºæ‰€æœ‰æ¶ˆæ¯è®°å½•
    clearAllMessages();
    return;
  }

  // å…ˆæ·»åŠ åˆ°pendingSet
  const sig = uid + '|' + msg;
  pendingSet.add(sig);

  // ç«‹å³æ˜¾ç¤ºæ¶ˆæ¯
  appendMessage({uid: uid, name: myNameSpan.textContent, txt: msg});

  // å‘é€åˆ°æœåŠ¡å™¨
  fetch('api.php', {
    method: 'POST',
    headers: {'Content-Type':'application/x-www-form-urlencoded'},
    body: 'act=send&uid=' + uid +
          '&name=' + encodeURIComponent(myNameSpan.textContent) +
          '&color=' + encodeURIComponent(color) +
          '&msg=' + encodeURIComponent(msg)
  }).then(r => r.json())
    .then(data => {
      // å‘é€æˆåŠŸåï¼ŒpendingSetä¼šåœ¨appendMessageä¸­å¤„ç†
      if (!data.ok) {
        // å¦‚æœå‘é€å¤±è´¥ï¼Œç§»é™¤pendingæ ‡è¯†
        pendingSet.delete(sig);
      }
    })
    .catch(err => {
      // ç½‘ç»œé”™è¯¯æ—¶ç§»é™¤pendingæ ‡è¯†
      pendingSet.delete(sig);
      console.error('å‘é€é”™è¯¯:', err);
    });

  txt.focus();
};

// æ¸…ç©ºæ‰€æœ‰æ¶ˆæ¯è®°å½•å‡½æ•°
function clearAllMessages() {
  // å…ˆæ¸…ç©ºèŠå¤©æ¡†
  box.innerHTML = '';
  
  // æ¸…ç©ºæœ¬åœ°çŠ¶æ€
  renderedIds.clear();
  pendingSet.clear();
  last = 0;
  
  // å‘é€æ¸…ç©ºè¯·æ±‚åˆ°æœåŠ¡å™¨
  fetch('api.php', {
    method: 'POST',
    headers: {'Content-Type':'application/x-www-form-urlencoded'},
    body: 'act=clear&uid=' + uid
  }).then(r => r.json())
    .then(data => {
      if (data.ok) {
        console.log('æ¶ˆæ¯è®°å½•å·²æ¸…ç©º');
      } else {
        alert('æ¸…ç©ºå¤±è´¥: ' + (data.err || 'æœªçŸ¥é”™è¯¯'));
        // å¦‚æœæ¸…ç©ºå¤±è´¥ï¼Œé‡æ–°æ‹‰å–æ¶ˆæ¯
        pullMessages();
      }
    })
    .catch(err => {
      console.error('æ¸…ç©ºé”™è¯¯:', err);
      alert('æ¸…ç©ºå¤±è´¥ï¼Œè¯·é‡è¯•');
      // å¦‚æœæ¸…ç©ºå¤±è´¥ï¼Œé‡æ–°æ‹‰å–æ¶ˆæ¯
      pullMessages();
    });
}

// è½®è¯¢å‡½æ•° - æ·»åŠ é”™è¯¯å¤„ç†å’Œæ›´ä¸¥æ ¼çš„é‡å¤æ£€æµ‹
function pullMessages() {
  fetch('api.php?act=pull&last=' + last)
    .then(r => r.json())
    .then(data => {
      if (data.msgs && data.msgs.length) {
        // è¿‡æ»¤æ‰å·²ç»æ¸²æŸ“è¿‡çš„æ¶ˆæ¯
        const newMessages = data.msgs.filter(m => !renderedIds.has(m.id));
        
        if (newMessages.length > 0) {
          console.log('æ‹‰å–åˆ°æ–°æ¶ˆæ¯:', newMessages.length);
          newMessages.forEach(m => appendMessage(m));
        }
      }
    })
    .catch(err => {
      console.error('è½®è¯¢é”™è¯¯:', err);
    });
}

// ä½¿ç”¨æ›´ç¨³å®šçš„è½®è¯¢æœºåˆ¶
setInterval(pullMessages, 1500);

// é¡µé¢åŠ è½½æ—¶ç«‹å³æ‹‰å–ä¸€æ¬¡æ¶ˆæ¯
setTimeout(pullMessages, 100);

// æ£€æµ‹è®¾å¤‡ç±»å‹å¹¶å¯ç”¨å›è½¦é”®å‘é€åŠŸèƒ½
function isDesktopDevice() {
  // æ£€æµ‹å±å¹•å®½åº¦å’Œç”¨æˆ·ä»£ç†æ¥åˆ¤æ–­æ˜¯å¦ä¸ºç”µè„‘è®¾å¤‡
  const isLargeScreen = window.innerWidth >= 768; // ä¸­ç­‰å±å¹•åŠä»¥ä¸Š
  const isDesktopUA = !/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  
  return isLargeScreen && isDesktopUA;
}

// å›è½¦é”®å‘é€æ¶ˆæ¯åŠŸèƒ½
function handleEnterKey(event) {
  // æ£€æŸ¥æ˜¯å¦ä¸ºå›è½¦é”®ï¼ˆEnteré”®ï¼‰
  if (event.key === 'Enter') {
    // æ£€æŸ¥æ˜¯å¦åŒæ—¶æŒ‰ä¸‹äº†Ctrlæˆ–Shifté”®ï¼ˆç”¨äºæ¢è¡Œï¼‰
    if (event.ctrlKey || event.shiftKey) {
      // å¦‚æœæŒ‰ä¸‹äº†Ctrl+Enteræˆ–Shift+Enterï¼Œæ’å…¥æ¢è¡Œç¬¦
      const start = txt.selectionStart;
      const end = txt.selectionEnd;
      const value = txt.value;
      
      // åœ¨å…‰æ ‡ä½ç½®æ’å…¥æ¢è¡Œç¬¦
      txt.value = value.substring(0, start) + '\n' + value.substring(end);
      
      // è®¾ç½®å…‰æ ‡ä½ç½®
      txt.selectionStart = txt.selectionEnd = start + 1;
      
      // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼ˆä¸å‘é€æ¶ˆæ¯ï¼‰
      event.preventDefault();
    } else {
      // å¦‚æœåªæŒ‰ä¸‹äº†Enteré”®ï¼Œå‘é€æ¶ˆæ¯
      event.preventDefault(); // é˜»æ­¢é»˜è®¤çš„æ¢è¡Œè¡Œä¸º
      sendBtn.click(); // è§¦å‘å‘é€æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
    }
  }
}

// åˆå§‹åŒ–å›è½¦é”®åŠŸèƒ½
function initEnterKeyFeature() {
  if (isDesktopDevice()) {
    console.log('æ£€æµ‹åˆ°ç”µè„‘è®¾å¤‡ï¼Œå·²å¯ç”¨å›è½¦é”®å‘é€æ¶ˆæ¯åŠŸèƒ½');
    console.log('ä½¿ç”¨è¯´æ˜ï¼š');
    console.log('- æŒ‰ Enter é”®ï¼šå‘é€æ¶ˆæ¯');
    console.log('- æŒ‰ Ctrl+Enter æˆ– Shift+Enterï¼šæ’å…¥æ¢è¡Œç¬¦');
    
    // æ·»åŠ å›è½¦é”®äº‹ä»¶ç›‘å¬å™¨
    txt.addEventListener('keydown', handleEnterKey);
    
    // æ·»åŠ æç¤ºä¿¡æ¯åˆ°é¡µé¢
    const enterHint = document.createElement('div');
    enterHint.style.cssText = 'text-align: center; font-size: 12px; color: #666; margin-top: 5px;';
    enterHint.textContent = 'æç¤ºï¼šæŒ‰ Enter å‘é€æ¶ˆæ¯ï¼ŒCtrl+Enter æ¢è¡Œ';
    
    // å°†æç¤ºä¿¡æ¯æ’å…¥åˆ°å‘é€æ¡†é™„è¿‘
    const footer = document.querySelector('.footer');
    if (footer) {
      footer.appendChild(enterHint);
    }
  } else {
    console.log('æ£€æµ‹åˆ°ç§»åŠ¨è®¾å¤‡ï¼Œç¦ç”¨å›è½¦é”®å‘é€æ¶ˆæ¯åŠŸèƒ½');
  }
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–å›è½¦é”®åŠŸèƒ½
document.addEventListener('DOMContentLoaded', function() {
  // ç­‰å¾…DOMå®Œå…¨åŠ è½½ååˆå§‹åŒ–
  setTimeout(initEnterKeyFeature, 100);
});
</script>
</body>
</html>
